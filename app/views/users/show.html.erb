<h1 class="title"><span>Eats</span> User Profile</h1>
<div class="user-container">
  <div class="user-card">
    <% if @user.avatar.present? %>
        <%= image_tag(@user.avatar.url, :class => "avatar border-white", :alt => "User profile picture", :size => '300x300') %>
    <% else %>
    <%= image_tag("http://www.argcapnet.org.ar/wp-content/uploads/2017/01/man.png", :class => "avatar border-white", :alt => "User profile picture") %>
    <% end %>
        <h1 class="profile-title"><%= @user.name %></h2>
        <h2 class="role"><%= @user.role %></h2>
        <% if !@user.avg_stars.nan? %>
          <h4><%= '%.2f' % @user.avg_stars %> Stars</h4>
        <% else %>
          <h4> Stars: no dish reviewed</h4>
        <% end %>
    <ul class="data">
      <li class="data">
        <span class="entypo-paper-plane"> <%= @user.email %></span>
      </li>
      <li class="data">
        <span class="entypo-phone"> <%= @user.phone %></span>
      </li>
      <li class="data">
        <span class="entypo-address"> <%= @user.address %></span>
      </li>
   </ul>
  </div>

  <div class="user-info">

    <div class="fav">
      <h1 class="profile-title">Favorite Dishes</h1>

        <% @dishes.each do |dish| %>
          <%- unless @user.favorite_dishes.exists?(id: dish.id) -%>

          <% else %>
            <%= render 'layouts/dish_item.html', dish: dish%>
          <% end %>
        <% end %>
    </div>


    <% if @user.dishes.size >0 %>
      <div class="user-dishes">
        <h1 class="profile-title"> <%=@user.name%>'s Dishes</h1>
          <% @user.dishes.each do |dish| %>
              <%= render 'layouts/dish_item.html', dish: dish%>
            <% end %>
      </div>
    <% end %>
  <% if current_user&.id == @user.id %>
    <div class"bank_account">
      <h1 class="profile-title">Bank Account</h1>
      <% if @user.bank_account.present? %>
        <p><strong>Type:</strong> <%= @user.bank_account.account_type %></p>
        <p><strong>ID card number:</strong> <%= @user.bank_account.id_card_number %></p>
        <p><strong>Account number:</strong> <%= @user.bank_account.account %></p>
        <p><strong>Bank:</strong> <%= @user.bank_account.bank %></p>
      <% else %>
        <%= link_to 'Update Bank Account', new_user_bank_account_path(@user) %>
      <% end %>
    </div>
    <% if @user.address.present? && (@user.is_cook? || @user.is_admin?) %>
      <div style='width: 600px;'>
        <div id="map" style='width: 600px; height: 300px;'></div>
      </div>
    <% end %>
  </div>
  <% end %>
</div>

<% if current_user&.id == @user.id %>
  <div class="links">
    <%= @user.api_token if @user == current_user %>
  </div>
<% end %>

<script type="text/javascript">
handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>
